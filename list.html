<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>JSAssist Open DCcon List</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css" media="screen,projection" </head>
  <style>
    .search-box {
      margin-top: 4rem;
      padding-left: 1rem;
      padding-right: 1rem;
    }

    #search {
      height: 2rem;
    }

    #search_wraper {
      width: 100%;
      height: 3rem;
    }

    .tag-label {
      margin-right: 1rem;
    }

    ul.autocomplete-content.dropdown-content {
      margin-top: -0.3rem;
      z-index: 99999999 !important;
      position: relative;
    }

    .dccon-item {
      cursor: pointer;
    }

    .dccon-name {
      font-size: 14px;
      height: 72px;
      padding: 8px !important;
    }

    .dccon-hidden {
      display: none;
    }

    @media only screen and (min-width: 993px) {
      #toast-container {
        top: initial;
        right: 5%;
        bottom: 7%;
        max-width: 90%;
      }
    }
  </style>
  <script>
  // 여기에 dccon_list.js의 내용을 붙여넣으세요
  var dcconList = [
    {'keywords' : ['우리핵박수', '우리핵박수1',], 'tags': ['우리핵', '움짤', '박수'], 'path': 'https://puu.sh/sYGQM/1887cb7d57.gif',},
    {'keywords' : ['우리핵박수2',], 'tags': ['우리핵', '움짤', '박수'], 'path': 'https://puu.sh/sYGTB/b97640a2ee.gif',},
    {'keywords' : ['우리핵박수3',], 'tags': ['우리핵', '움짤', '박수'], 'path': 'https://puu.sh/sYGSK/25b3818f96.gif',},
    {'keywords' : ['우리핵안녕',], 'tags': ['우리핵', '움짤', '인사'], 'path': 'https://puu.sh/sYGNQ/a17abeb117.gif',},
    {'keywords' : ['우리핵아닌데',], 'tags': ['우리핵', '움짤',], 'path': 'https://puu.sh/sYGPz/bb15124f7a.gif',},
    {'keywords' : ['우리핵투정',], 'tags': ['우리핵', '움짤',], 'path': 'https://puu.sh/wgfiI/86ff533345.gif',},
    {'keywords' : ['우리핵드럼',], 'tags': ['우리핵', '움짤',], 'path': 'https://puu.sh/wgfg4/c7cbe33ddf.gif',},
    {'keywords' : ['우리핵쌍안경',], 'tags': ['우리핵', '움짤',], 'path': 'https://puu.sh/wgfjZ/6532603509.gif',},
    {'keywords' : ['우리핵빵야',], 'tags': ['우리핵', '움짤',], 'path': 'https://puu.sh/wgfi1/c5d6eb049f.gif',},
  ];
  </script>
</head>

<body class="blue-grey darken-4">
  <div class="container">
    <div class="row">
      <div class="col s12 l6 offset-l3">
        <div class="search-box card z-depth-3 valign-wrapper hoverable">
          <div class="input-field inline" id="search_wraper">
            <i class="material-icons prefix">search</i>
            <input type="text" id="search" class="autocomplete">
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col s12 l10 offset-l1">
        <div class="tags">
        </div>
      </div>
    </div>
    <div class="row dccon-list"></div>
  </div>

  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      var seletedTags = [];
      var currentSearchText = "";
      var dcconSearchMap = {}; // keyword로 dccon을 찾을 수 있도록 하는 맵
      var dcconKeywordList = []; // 전체 keyword 리스트
      var autocompleteData = {};
      var tags = [];
      // dcconSearchMap, dcconKeywordList 초기화
      for (var i = 0; i < dcconList.length; i++) {
        var dccon = dcconList[i];
        for (var j = 0; j < dccon.tags.length; j++) {
          var tag = dccon.tags[j];
          if (tags.indexOf(tag) == -1) {
            tags.push(tag);
          }
        }
        for (var j = 0; j < dccon.keywords.length; j++) {
          var keyword = dccon.keywords[j];
          dcconSearchMap[keyword] = dccon;
          dcconKeywordList.push(keyword);
          autocompleteData[keyword] = dccon.path;

          $('div.dccon-list').append('<div class="dccon col s4 m2" data-keyword="' + keyword + '" data-tags="' + dccon.tags.join(',') + '" data-clipboard-text="~' + keyword + '">' +
            '<div class="dccon-item card z-depth-3 hoverable">' +
            '<div class="card-image">' +
            '    <img src="' + dccon.path + '">' +
            '  </div>' +
            '  <div class="card-content dccon-name">' +
            '    <p>' + keyword + '</p>' +
            '  </div>' +
            '</div>' +
            '</div>');
        }
      }

      tags.sort();
      new Clipboard('.dccon').on('success', function(e) {
        Materialize.toast('디씨콘 "' + e.text + '"을(를) 복사했습니다. 이제 채팅창에 입력하세요!', 4000);
      });

      for (var i = 0; i < tags.length; i++) {
        var tag = tags[i];
        $('div.tags').append('<input type="checkbox" class="filled-in tag-checkbox" id="tag-' + i + '" data-tag="' + tag + '"/>'
         + '<label for="tag-' + i + '" class="tag-label">'+ tag + '</label>');
      }

      $('input#search').autocomplete({
        data: autocompleteData,
        limit: 5,
        onAutocomplete: function(val) {
          currentSearchText = val;
          updateList();
        },
        minLength: 1,
      });

      function updateList() {
        $('.dccon').each(function() {
          var $this = $(this);
          var keyword = $this.data('keyword');
          var tags = $this.data('tags').split(',');

          if (seletedTags.length > 0) {
            var hasTag = false;
            for (var i = 0; i < tags.length; i++) {
              if (seletedTags.indexOf(tags[i]) != -1) {
                hasTag = true;
                break;
              }
            }
            if (!hasTag) {
              $this.addClass('dccon-hidden');
              return;
            }
          }
          if (currentSearchText.length > 0 && keyword.indexOf(currentSearchText) == -1) {
            $this.addClass('dccon-hidden');
            return;
          }
          $this.removeClass('dccon-hidden');
          return;
        })
      }

      $('input#search').on('input',function(e){
        currentSearchText = $('input#search').val();
        updateList();
      });

      $('.tag-checkbox').change(function() {
        var $this = $(this);
        var tag = $this.data('tag');
        if ($this.prop("checked")) {
          seletedTags.push(tag);
        } else {
          var index = seletedTags.indexOf(tag);
          if (index >= 0) {
            seletedTags.splice(index, 1);
          }
        }
        updateList();
      });
      updateList();
    });
  </script>
</body>

</html>
